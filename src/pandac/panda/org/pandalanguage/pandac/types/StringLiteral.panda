package org.pandalanguage.pandac.tree

uses org.pandalanguage.pandac.types.ClassType
uses org.pandalanguage.pandac.types.StringOrCharType
uses org.pandalanguage.pandac.types.Type

class StringLiteral : Value {
    def value:String
    
    constructor(position:Position, value:String) {
        constructor(position, value, getType(value))
    }
    
    constructor(position:Position, value:String, type:Type) {
        super.constructor(position, type)
        self.value := value
    }
    
    method getType(value:String):Type {
        if value.length = 1
            return StringOrCharType.STRING_OR_CHAR
        else
            return ClassType.STRING
    }
    
    @class
    function escape(s:String):String {
        return s.replace("\\", "\\\\").replace("\n", "\\n").replace("\r", "\\r")
                .replace("\t", "\\t").replace('"', '\\"')
    }
    
    @override
    function format(fmt:String):String {
        return '"' + escape(value) + '"'
    }
}